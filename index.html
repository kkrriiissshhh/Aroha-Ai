<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aroha AI - Chat Assistant</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/ogl"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #e0e0e0;
        }

        #animated-background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.08);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        #chat-container::-webkit-scrollbar { width: 8px; }
        #chat-container::-webkit-scrollbar-track { background: transparent; }
        #chat-container::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 4px; }
        #chat-container::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.4); }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeInUp {
            animation: fadeInUp 0.4s ease-out forwards;
        }

        .typing-indicator span {
            height: 8px; width: 8px; background-color: #a78bfa;
            border-radius: 50%; display: inline-block; margin: 0 2px;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-of-type(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-of-type(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        @keyframes pulse-haptic {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        .pulse-haptic {
            animation: pulse-haptic 0.15s ease-out;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col">

    <canvas id="animated-background-canvas"></canvas>

    <header class="absolute top-4 left-4 z-20 flex items-center">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mr-2">
            <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12C4 7.58172 7.58172 4 12 4ZM12 6C9.79086 6 8 7.79086 8 10C8 12.2091 9.79086 14 12 14C14.2091 14 16 12.2091 16 10C16 7.79086 14.2091 6 12 6ZM12 8C13.1046 8 14 8.89543 14 10C14 11.1046 13.1046 12 12 12C10.8954 12 10 11.1046 10 10C10 8.89543 10.8954 8 12 8Z" fill="url(#gradient-aroha-logo)"/>
            <defs>
                <linearGradient id="gradient-aroha-logo" x1="2" y1="12" x2="22" y2="12" gradientUnits="userSpaceOnUse">
                    <stop stop-color="#a78bfa"/>
                    <stop offset="1" stop-color="#6366f1"/>
                </linearGradient>
            </defs>
        </svg>
        <span class="text-2xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-indigo-500">Aroha</span>
    </header>

    <main id="chat-container" class="flex-1 overflow-y-auto p-4 w-full max-w-3xl mx-auto pt-20">
        <div class="space-y-4">
            <div class="flex justify-start animate-fadeInUp">
                <div class="flex items-end gap-2">
                   <div class="w-7 h-7 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex-shrink-0 flex items-center justify-center text-sm font-bold text-white">A</div>
                   <div class="glass-effect text-white p-3 rounded-xl rounded-bl-none max-w-[80%]">
                       <p>Hello! I am Aroha, your friendly AI assistant. How can I help you today?</p>
                   </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="w-full max-w-3xl mx-auto p-4 flex-shrink-0">
        <div class="flex items-center space-x-3 w-full">
            <input type="text" id="userInput" placeholder="Ask Aroha anything..." class="flex-1 p-3 glass-effect text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300 placeholder-gray-400">
            <button id="sendButton" class="bg-gradient-to-br from-indigo-500 to-blue-600 text-white p-3 rounded-xl hover:from-indigo-600 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900 transition-all transform active:scale-95 disabled:from-gray-500 disabled:to-gray-600 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                </svg>
            </button>
        </div>
    </footer>
    
    <script type="module">
        // --- New Starfield Background Shader ---
        const vertex = `
            attribute vec2 position;
            void main() {
                gl_Position = vec4(position, 0.0, 1.0);
            }
        `;

        const fragment = `
            #ifdef GL_ES
            precision highp float;
            #endif

            uniform float uTime;
            uniform vec2 uResolution;

            // Pseudo-random generator
            float rand(vec2 n) { 
                return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);
            }

            // 2D Noise function
            float noise(vec2 p) {
                vec2 ip = floor(p);
                vec2 u = fract(p);
                u = u*u*(3.0-2.0*u);
                
                float res = mix(
                    mix(rand(ip), rand(ip + vec2(1.0, 0.0)), u.x),
                    mix(rand(ip + vec2(0.0, 1.0)), rand(ip + vec2(1.0, 1.0)), u.x), u.y);
                return res*res;
            }

            // FBM for nebula/clouds
            float fbm(vec2 x) {
                float v = 0.0;
                float a = 0.5;
                vec2 shift = vec2(100.0);
                mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50));
                for (int i = 0; i < 5; ++i) {
                    v += a * noise(x);
                    x = rot * x * 2.0 + shift;
                    a *= 0.5;
                }
                return v;
            }

            // Star function
            float star(vec2 uv, float flare) {
                float d = length(uv);
                float m = .05 / d;
                
                float rays = max(0., 1. - abs(uv.x * uv.y * 1000.));
                m += rays * flare * 0.08;
                
                return m;
            }

            void main() {
                vec2 uv = (gl_FragCoord.xy - 0.5 * uResolution.xy) / uResolution.y;
                vec2 originalUv = uv;

                float speed = uTime * 0.2;
                vec3 finalColor = vec3(0.0);
                
                // --- Nebula/Glow ---
                vec2 fbmUv = uv * 1.5;
                float cloud = fbm(fbmUv + uTime * 0.05);
                vec3 nebulaColor = mix(vec3(0.1, 0.0, 0.2), vec3(0.2, 0.05, 0.3), cloud); // Dark purples
                finalColor += nebulaColor;

                // --- Stars (3 layers for parallax) ---
                for (int i = 1; i <= 3; i++) {
                    float layer = float(i);
                    float layerSpeed = layer * 0.8;
                    vec2 starUv = uv * (3.0 + (layer * 2.0));
                    starUv += vec2(speed * layerSpeed, speed * 2.0 * layerSpeed);

                    vec2 grid = floor(starUv);
                    vec2 st = fract(starUv) - 0.5;

                    float star_intensity = rand(grid);
                    if (star_intensity > 0.98) {
                        float size = (star_intensity - 0.98) * 35.0;
                        float star_light = star(st, 0.8) * size;
                        finalColor += vec3(star_light * 0.8, star_light * 0.9, star_light * 1.2);
                    }
                }

                gl_FragColor = vec4(finalColor, 1.0);
            }
        `;

        const backgroundCanvas = document.getElementById('animated-background-canvas');
        const renderer = new ogl.Renderer({ dpr: Math.min(window.devicePixelRatio, 2), canvas: backgroundCanvas });
        const gl = renderer.gl;
        const geometry = new ogl.Triangle(gl);

        const program = new ogl.Program(gl, {
            vertex,
            fragment,
            uniforms: {
                uTime: { value: 0 },
                uResolution: { value: new ogl.Vec2() },
            },
        });

        const mesh = new ogl.Mesh(gl, { geometry, program });

        const resizeBackground = () => {
            const w = window.innerWidth;
            const h = window.innerHeight;
            renderer.setSize(w, h);
            program.uniforms.uResolution.value.set(w, h);
        };

        window.addEventListener("resize", resizeBackground);
        resizeBackground();

        const animateBackground = (time) => {
            program.uniforms.uTime.value = time * 0.001;
            renderer.render({ scene: mesh });
            requestAnimationFrame(animateBackground);
        };
        requestAnimationFrame(animateBackground);
    </script>


    <script>
        // --- Chat Functionality ---
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');

        const chatHistory = [];
        const systemPrompt = "You are Aroha, a helpful and friendly AI assistant. You were created by Krishanu Kashyap Choudhury. Your purpose is to answer questions and assist users. If you are asked your name, you must respond with 'My name is Aroha.' If you are asked who made you or who your creator is, you must respond with 'I was made by Krishanu Kashyap Choudhury.' Be polite and helpful in all your responses.";

        chatHistory.push({ role: "system", parts: [{ text: systemPrompt }] });
        
        const appendMessage = (sender, message) => {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('flex', 'animate-fadeInUp');
            
            let bubbleHtml = '';

            if (sender === 'user') {
                messageWrapper.classList.add('justify-end');
                bubbleHtml = `<div class="glass-effect bg-blue-500/20 text-white p-3 rounded-xl rounded-br-none max-w-[80%]"><p>${message}</p></div>`;
            } else {
                messageWrapper.classList.add('justify-start');
                bubbleHtml = `
                    <div class="flex items-end gap-2">
                        <div class="w-7 h-7 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex-shrink-0 flex items-center justify-center text-sm font-bold text-white">A</div>
                        <div class="glass-effect bg-purple-500/20 text-white p-3 rounded-xl rounded-bl-none max-w-[80%]">
                            <p>${message}</p>
                        </div>
                    </div>`;
            }
            
            messageWrapper.innerHTML = bubbleHtml;
            chatContainer.querySelector('.space-y-4').appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };
        
        const showLoadingIndicator = () => {
            const loadingWrapper = document.createElement('div');
            loadingWrapper.id = 'loading-indicator';
            loadingWrapper.classList.add('flex', 'justify-start', 'animate-fadeInUp');
            loadingWrapper.innerHTML = `
                <div class="flex items-end gap-2">
                    <div class="w-7 h-7 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex-shrink-0 flex items-center justify-center text-sm font-bold text-white">A</div>
                    <div class="glass-effect bg-gray-700/20 text-white p-3 rounded-xl rounded-bl-none">
                        <div class="typing-indicator"><span></span><span></span><span></span></div>
                    </div>
                </div>`;
            chatContainer.querySelector('.space-y-4').appendChild(loadingWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };

        const removeLoadingIndicator = () => {
            document.getElementById('loading-indicator')?.remove();
        };

        const triggerHapticFeedback = (element) => {
            element.classList.add('pulse-haptic');
            element.addEventListener('animationend', () => {
                element.classList.remove('pulse-haptic');
            }, { once: true });
        };

        const callGeminiAPI = async (prompt) => {
            const apiKey = "AIzaSyAEObxGN_s5-Rz-pqmiEv_Pp_YPmwo_GC0"; // <-- IMPORTANT: Replace with your key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            
            const payload = {
                contents: chatHistory.filter(item => item.role !== "system"),
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    return `Sorry, I encountered an error: ${error.error.message}`;
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate?.content?.parts?.[0]?.text) {
                    const aiResponse = candidate.content.parts[0].text;
                    chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                    return aiResponse;
                } else {
                    return "Sorry, I couldn't generate a response.";
                }

            } catch (error) {
                return "Sorry, I'm having trouble connecting. Please check your network and try again.";
            }
        };
        
        const handleSendMessage = async () => {
            const message = userInput.value.trim();
            if (message === '') return;

            appendMessage('user', message);
            userInput.value = '';
            userInput.disabled = true;
            sendButton.disabled = true;
            triggerHapticFeedback(sendButton);

            showLoadingIndicator();
            const aiResponse = await callGeminiAPI(message);
            removeLoadingIndicator();
            appendMessage('aroha', aiResponse);
            
            userInput.disabled = false;
            sendButton.disabled = false;
            userInput.focus();
        };

        sendButton.addEventListener('click', handleSendMessage);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                handleSendMessage();
            }
        });
    </script>

</body>

</html>

